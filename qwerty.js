!function(){"use strict";const t=t=>{const e=function(t){const e=document.createElement("a");return e.href=t,{protocol:e.protocol,hostname:e.hostname,port:e.port,pathname:e.pathname,search:e.search,hash:e.hash,host:e.host,href:t}}(t),n=-1!==e.protocol.indexOf("https")?443:80,o=(r=e.port,!isNaN(parseFloat(r))&&isFinite(r)?parseInt(e.port,10):n);var r;let s=`${e.protocol}//${e.hostname}`;return-1===[80,443,8443].indexOf(o)&&(s+=`:${o}`),s};class e{static on(t,e){window.addEventListener("message",(n=>{let o={};const r=n.source;if(t===n.origin){try{o="string"==typeof n.data?JSON.parse(n.data):n.data}catch(t){return}o.isAnnoto&&e(o,(t=>{const e={...t,id:o.id,action:o.action,handler:o.handler,isAnnoto:!0};r.postMessage(e,n.origin)}))}}),!1)}static post(t,e){parent.postMessage({...e,isAnnoto:!0},t)}}const n=Object.freeze({INFO:1,WARN:2,ERROR:3,NOLOG:4});class o{id="";level=n.INFO;constructor(t,e){this.id=t,this.level=e}log(t,...e){this.level>n.INFO||console.log(`(Annoto) INFO [${this.id}]: ${t}`,...e)}warn(t,...e){this.level>n.WARN||console.warn(`(Annoto) WARN [${this.id}]: ${t}`,...e)}error(t,...e){this.level>n.ERROR||console.error(`(Annoto) ERROR [${this.id}]: ${t}`,...e)}setLevel(t){this.level=t}}let r=n.WARN;try{sessionStorage.getItem("ANNOTO_IFRAME_CLIENT_DEBUG")&&(r=n.INFO)}catch(t){}new o("IframeClient",r);class s{constructor(t){this._onPing=t}handleMessage(t,e){return"ping"===t.action&&"function"==typeof this._onPing&&this._onPing(),e({data:t})}}class a{annotoApi;constructor(t){this.annotoApi=t}handleMessage=(t,e)=>{const n=this.annotoApi;if(!n)return e({err:new Error("widget Api not setup")});if("function"!=typeof n[t.action])return e({err:new Error(`invalid action: ${t.action}`)});return(t.data?n[t.action](t.data):n[t.action]()).then((t=>{e({...t})})).catch((t=>{e({err:t})}))}}class i{constructor(t){this.onSetup=t}handleMessage=(t,e)=>{if(!window.Annoto)return e({err:new Error("Annoto widget not loaded")});if("boot"===t.action){const n=this.onSetup({...t.data});return Annoto.boot(n),e()}return e({err:new Error("invalid setup action")})}}const l=n=>{const r=new o("IframeAgent"),l={};r.log("start");const c=t(n.pageUrl||document.referrer),d=n.bootstrapUrl||"https://app.annoto.net/annoto-bootstrap.js";let p=!1,h=!1,u=!1;const g=()=>{h?r.warn("already setup"):(Annoto.on("ready",(t=>{l.api=new a(t),r.log("ready"),"function"==typeof n.onReady&&n.onReady(t),e.post(c,{handler:"event",action:"ready"})})),l.setup=new i((t=>{const o=(t=>{const o={...t};delete o._iframeAddons;const r=t._iframeAddons||{},s=r.uxCallbacks||{},a=(t.widgets||[])[0]||{},i={...a,player:{...a.player}},l=t.hooks||{};return o.hooks=l,o.clientId=n.clientId,o.widgets=[i],r.mediaDetails&&(l.mediaDetails=({details:t})=>{const e={...t,...r.mediaDetails};return t?.title&&(e.title=t.title),t?.description&&(e.description=t.description),e}),r.getPageUrl&&(l.getPageUrl=()=>n.pageUrl||document.referrer),s.ssoAuthRequestHandle&&(l.ssoAuthRequestHandle=()=>{e.post(c,{handler:"event",action:"ssoAuthRequest"})}),s.logoutRequestHandle&&(l.logoutRequestHandle=()=>{e.post(c,{handler:"event",action:"logoutRequest"})}),o})(t);return"function"==typeof n.onSetup&&n.onSetup(o),o})),h=!0,r.log("setup"),e.post(c,{handler:"event",action:"setup"}))};l.echo=new s((()=>{p=!0,!h&&u&&g()})),e.on(c,((t,e)=>l[t.handler]?l[t.handler].handleMessage(t,e):(r.warn(`unknown host api handler: ${t.handler}`),e({err:new Error(`invalid handler ${t.handler}`)})))),((t,e)=>{const n=document,o=n.createElement("script");o.type="text/javascript",o.async=!0,o.src=t,o.onload=()=>e(),o.onerror=t=>e(t);const r=n.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(o,r):n.body.appendChild(o)})(d,(t=>{t?r.error("widget bootstap script load error"):(u=!0,p&&!h&&g())}))};Wistia.plugin("annoto",((t,e)=>{const n=t.params?.pageUrl||document.referrer;l({pageUrl:n,clientId:"eyJhbGciOiJIUzI1NiJ9.ZGRiZGQwMDAtNzVhYS00ZjhlLWIyNDItYjk4YzVlZjQyOGZk.rDULvDwCb7bQv3wV51LnaRh-RMriscbLI74qXVl6UdY",bootstrapUrl:"https://cdn.annoto.net/widget/latest/bootstrap.js",onSetup:e=>{const n=e.widgets[0];n.player={...n.player,type:"wistia",element:t.container},n.timeline={...n.timeline,overlay:!0}}})}))}();
